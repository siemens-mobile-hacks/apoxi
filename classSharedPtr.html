<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>APOXI: SharedPtr&lt; T_obj &gt; Class Template Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6-NO -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li id="current"><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="classes.html"><span>Alphabetical&nbsp;List</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
  </ul></div>
<h1>SharedPtr&lt; T_obj &gt; Class Template Reference<br>
<small>
[<a class="el" href="group__Devices.html">Devices</a>]</small>
</h1><!-- doxytag: class="SharedPtr" --><!-- doxytag: inherits="Linkable&lt; SharedPtr&lt; T_obj &gt; &gt;" --><code>#include &lt;<a class="el" href="SharedPtr_8hpp-source.html">Apoxi/Auxiliary/SharedPtr.hpp</a>&gt;</code>
<p>
Inheritance diagram for SharedPtr&lt; T_obj &gt;:<p><center><img src="classSharedPtr__inherit__graph.png" border="0" usemap="#SharedPtr_3_01T__obj_01_4__inherit__map" alt="Inheritance graph"></center>
<map name="SharedPtr_3_01T__obj_01_4__inherit__map">
<area href="classSharedPtr.html" shape="rect" coords="7,343,207,369" alt="">
<area href="classSharedPtr.html" shape="rect" coords="231,343,468,369" alt="">
<area href="classSharedPtr.html" shape="rect" coords="492,343,737,369" alt="">
<area href="classLinkable.html" shape="rect" coords="243,175,456,201" alt="">
<area href="classLinkableBase.html" shape="rect" coords="308,7,409,33" alt="">
<area href="classLinkable.html" shape="rect" coords="365,84,469,111" alt="">
</map>
<center><font size="2">[<a href="graph_legend.html">legend</a>]</font></center>Collaboration diagram for SharedPtr&lt; T_obj &gt;:<p><center><img src="classSharedPtr__coll__graph.png" border="0" usemap="#SharedPtr_3_01T__obj_01_4__coll__map" alt="Collaboration graph"></center>
<map name="SharedPtr_3_01T__obj_01_4__coll__map">
<area href="classLinkable.html" shape="rect" coords="7,175,220,202" alt="">
<area href="classLinkableBase.html" shape="rect" coords="72,7,173,34" alt="">
<area href="classLinkable.html" shape="rect" coords="129,84,233,111" alt="">
</map>
<center><font size="2">[<a href="graph_legend.html">legend</a>]</font></center><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#g75327d940701077895b21c6768b932eb">Clear</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const T_obj &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#gacbc131431ab2c01e57f6cfa557ad1bd">operator *</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">T_obj &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#g817ed27c07acfef4e86f68b2e1a6aac6">operator *</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#gf9650e5dd1a9ab28200129c57a496fff">operator bool</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#gfeb82bcdb57756ca6781c6d9034d1e39">operator!=</a> (const <a class="el" href="classSharedPtr.html">SharedPtr</a>&lt; T_obj &gt; &amp;<a class="el" href="ScrollHorizontal__Planes_8cpp.html#b0ac080dffeb23046edbaa6790db4ac7">src</a>) const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compare the underlying pointers for inequality.  <a href="group__Devices.html#gfeb82bcdb57756ca6781c6d9034d1e39"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">T_obj *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#g2e8442669ebe3046b54c2ffc6cc238dc">operator-&gt;</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classSharedPtr.html">SharedPtr</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#g1f68d329f548adad87d2a6c528e17029">operator=</a> (const <a class="el" href="classSharedPtr.html">SharedPtr</a>&lt; T_obj &gt; &amp;<a class="el" href="ScrollHorizontal__Planes_8cpp.html#b0ac080dffeb23046edbaa6790db4ac7">src</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Share ownership.  <a href="group__Devices.html#g1f68d329f548adad87d2a6c528e17029"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#gdf98148481993e47edd9f4a3af211365">operator==</a> (const <a class="el" href="classSharedPtr.html">SharedPtr</a>&lt; T_obj &gt; &amp;<a class="el" href="ScrollHorizontal__Planes_8cpp.html#b0ac080dffeb23046edbaa6790db4ac7">src</a>) const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compare the underlying pointers for equality.  <a href="group__Devices.html#gdf98148481993e47edd9f4a3af211365"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#gae9398d056f5a35b6d049f0a614733a4">SharedPtr</a> (const <a class="el" href="classSharedPtr.html">SharedPtr</a>&lt; T_obj &gt; &amp;<a class="el" href="ScrollHorizontal__Planes_8cpp.html#b0ac080dffeb23046edbaa6790db4ac7">src</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#g3ee61819919bf24b04888920ccbfb287">SharedPtr</a> (T_obj *pobj)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#g12339592745211eb3206a3f3e772ff59">SharedPtr</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#g312b254f8cdf7914734e27178a9f842a">~SharedPtr</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy from different, but castable type.  <a href="group__Devices.html#g312b254f8cdf7914734e27178a9f842a"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#gd39b5d39d141d80a0ccd65a3cda9125f">Ref</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Devices.html#g7447845244eac196b2b5205aae09145c">Unref</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">T_obj *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSharedPtr.html#3ab0cf84f911b3580c6e044cc0e4ce21">m_pobj</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
<h3>template&lt;typename T_obj&gt;<br>
 class SharedPtr&lt; T_obj &gt;</h3>

A shared reference-counting smart-pointer. For use only with classes that derive from <a class="el" href="classReferableObject.html">ReferableObject</a>. This is not a real smart-pointer, because the target compilers do not all support templated copy constructors and operator=. This means that you cannot cast an instance of the smart-pointer to a related instance of another smart-pointer. Therefore, methods should never take SmartPointers, but a reference to the underlying type instead. Yes, this is unusual, and requires care. For instance: SharedPtr&lt;Derived&gt; derived = something.GetSomething(); somethingelse.SetSomething(*derived);<p>
Note the alternative is to not use a smart-pointer and to require manual reference-counting. Note that the reference-counting should not really be in the underlying object, but in smart-pointer. Unfortunately in this case it must be in the object (Referable) because we must sometimes create a second smart-pointer to the same underlying object without using the copy constructor.<p>
Boring technical details:<p>
Question: Why can't I implicitly cast a SharedPtr-of-a-derived-class to a SharedPtr-of-a-base-class? Answer: Because that needs a templated copy constructor (a copy constructor that can take any type as the source object), but the compiler does not support templated methods of templated classes. This is easy and normal with standards-compliant compilers.<p>
Question: Why can't I explicitly cast a SharedPtr-of-a-derived-class to a SharedPtr-of-a-base-class, or in the other direction? Answer: Again, that would require a templated method of a templated class, which the compiler does not support.<p>
Question: So, how do I cast a SharedPtr-of-class-A to a SharedPtr-of-a-class-B? Answer: It's ugly, so we try to keep this inside APOXI implementation code.<p>
You need to do this: <a class="el" href="classSharedPtr.html">SharedPtr</a> refA = get_something(); // Function get_something() actually returns a B*. <a class="el" href="classSharedPtr.html">SharedPtr</a><b> refB = <a class="el" href="classSharedPtr.html">SharedPtr</a><b>(static_cast&lt;B*&gt;(&amp;(*refA))); // Cast from A* to B*. The second statement<ul>
<li>dereferences the refA to get A&amp;, with the * dereference operator. This is just like dereferencing a normal A* pointer with * to get A&amp;,</li><li>gets the address of A&amp;, with &amp;, to get a normal A*,</li><li>downcasts the A* to B* (it is known that A* is actually a B*), and</li><li>gives the B* to the <a class="el" href="classSharedPtr.html">SharedPtr</a><b> constructor, to create a new <a class="el" href="classSharedPtr.html">SharedPtr</a><b>.</b></b></li></ul>
</b></b><p>
<b><b><b><b> We make it easier for application writers by making all methods take normal references instead of SharedPtr&lt;&gt;s, and telling people to dereference the SharedPtr&lt;&gt; with * to get the reference to give to the method. The compiler can then easily cast that normal reference, and that allows polymorphism to work.</b></b></b></b><p>
<b><b><b><b> Question: Why is this an intrusive smart-pointer? Wouldn't it be better if the count was in the smart-pointer instead of the object? Answer: Yes, that would be better, but it does not work when we can not cast normally. When we cast, we need to take the object out of the SharedPtr&lt;&gt; and put it into another SharedPtr&lt;&gt;. But both SharedPtr&lt;&gt;s still need to use the same count. Without a templated constructor (see above), the only way to keep the count connected with the object is to put it in the object itself. </b></b></b></b>
<p>
<hr><h2>Field Documentation</h2>
<a class="anchor" name="3ab0cf84f911b3580c6e044cc0e4ce21"></a><!-- doxytag: member="SharedPtr::m_pobj" ref="3ab0cf84f911b3580c6e044cc0e4ce21" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="mdPrefix" colspan="4">
template&lt;typename T_obj&gt; </td>
        </tr>
        <tr>
          <td class="md" nowrap valign="top">T_obj* <a class="el" href="classSharedPtr.html">SharedPtr</a>&lt; T_obj &gt;::<a class="el" href="classSharedPtr.html#3ab0cf84f911b3580c6e044cc0e4ce21">m_pobj</a><code> [mutable, protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li>Auxiliary/<a class="el" href="SharedPtr_8hpp-source.html">SharedPtr.hpp</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Wed Jan 25 01:48:54 2006 for APOXI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6-NO </small></address>
</body>
</html>
